<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMDb Sentiment Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .container {
            max-width: 1000px;
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.95);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
        }
        
        .form-control {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102,126,234,0.25);
        }
        
        .result-card {
            margin-top: 20px;
            animation: fadeInUp 0.5s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .sentiment-positive {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            color: white;
        }
        
        .sentiment-negative {
            background: linear-gradient(45deg, #cb2d3e, #ef473a);
            color: white;
        }
        
        .progress {
            height: 10px;
            border-radius: 10px;
        }
        
        .loading {
            display: none;
        }
        
        .example-review {
            background: rgba(255,255,255,0.8);
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .example-review:hover {
            background: rgba(255,255,255,1);
            transform: translateX(5px);
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <!-- Header -->
        <div class="text-center mb-5">
            <h1 class="display-4 text-white fw-bold mb-3">
                <i class="fas fa-film text-warning"></i>
                IMDb Sentiment Analysis
            </h1>
            <p class="lead text-white-50">
                Analyze movie review sentiment using Machine Learning & Deep Learning
            </p>
        </div>

        <!-- Main Card -->
        <div class="card">
            <div class="card-body p-5">
                <!-- Model Status Alert -->
                {% if not model_status.any_model_available %}
                <div class="alert alert-danger mb-4">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Warning:</strong> No models are currently loaded. Predictions will not work.
                    Please check the console for more information.
                </div>
                {% endif %}

                <!-- Input Form -->
                <div class="mb-4">
                    <label for="reviewText" class="form-label h5">
                        <i class="fas fa-comment-alt text-primary"></i>
                        Enter Movie Review
                    </label>
                    <textarea 
                        id="reviewText" 
                        class="form-control" 
                        rows="6" 
                        placeholder="Type your movie review here... (e.g., 'This movie was absolutely amazing! The plot was engaging and the acting was superb.')"
                        {% if not model_status.any_model_available %}disabled{% endif %}
                    ></textarea>
                    <div class="form-text">
                        Enter a movie review to analyze its sentiment (positive or negative)
                    </div>
                    
                    <!-- Model Status Info -->
                    <div class="mt-2">
                        <small>
                            Models available: 
                            {% if model_status.traditional %}
                            <span class="badge bg-success">Traditional ML ✓</span>
                            {% else %}
                            <span class="badge bg-danger">Traditional ML ✗</span>
                            {% endif %}
                            
                            {% if model_status.deep_learning %}
                            <span class="badge bg-success">Deep Learning ✓</span>
                            {% else %}
                            <span class="badge bg-danger">Deep Learning ✗</span>
                            {% endif %}
                        </small>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="d-grid gap-2 d-md-flex justify-content-md-start mb-4">
                    <button id="analyzeBtn" class="btn btn-primary btn-lg me-md-2" onclick="analyzeSentiment()" {% if not model_status.any_model_available %}disabled{% endif %}>
                        <i class="fas fa-brain"></i>
                        Analyze Sentiment
                    </button>
                    <button class="btn btn-outline-secondary" onclick="clearText()">
                        <i class="fas fa-eraser"></i>
                        Clear
                    </button>
                </div>

                <!-- Loading -->
                <div id="loading" class="loading text-center mb-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 text-muted">Analyzing sentiment...</p>
                </div>

                <!-- Results -->
                <div id="results"></div>
            </div>
        </div>

        <!-- Example Reviews -->
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-lightbulb text-warning"></i>
                    Try These Examples
                </h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="example-review" onclick="useExample(this)">
                            <strong>Positive Example:</strong><br>
                            "This movie was absolutely fantastic! The cinematography was breathtaking, the acting was superb, and the plot kept me engaged from start to finish. Definitely one of the best films I've seen this year!"
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="example-review" onclick="useExample(this)">
                            <strong>Negative Example:</strong><br>
                            "What a disappointment. The plot was confusing, the dialogue felt forced, and the pacing was terrible. I was bored throughout most of the movie and couldn't wait for it to end."
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="example-review" onclick="useExample(this)">
                            <strong>Mixed Example:</strong><br>
                            "The movie had some good moments and decent special effects, but overall it felt like something was missing. The story was okay but not memorable."
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="example-review" onclick="useExample(this)">
                            <strong>Short Example:</strong><br>
                            "Amazing movie! Loved it!"
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-5">
            <p class="text-white-50">
                <i class="fas fa-graduation-cap"></i>
                Created by NGUYEN Ngoc Dang Nguyen - Computer Science Student
            </p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function useExample(element) {
            const text = element.textContent.split(': ')[1];
            document.getElementById('reviewText').value = text;
        }

        function clearText() {
            document.getElementById('reviewText').value = '';
            document.getElementById('results').innerHTML = '';
        }

        async function analyzeSentiment() {
            const text = document.getElementById('reviewText').value.trim();
            
            if (!text) {
                alert('Please enter some text to analyze!');
                return;
            }

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').innerHTML = '';
            document.getElementById('analyzeBtn').disabled = true;

            try {
                console.log("Sending text for prediction:", text);
                
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text })
                });

                if (!response.ok) {
                    throw new Error(`Server responded with status: ${response.status}`);
                }

                const data = await response.json();
                console.log("Received prediction response:", data);

                if (data.error) {
                    throw new Error(data.error);
                }

                // Check if we got results back
                if (!data.results || (Object.keys(data.results).length === 0)) {
                    throw new Error('No prediction results returned from the server.');
                }

                displayResults(data);

            } catch (error) {
                console.error("Error during prediction:", error);
                document.getElementById('results').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Error:</strong> ${error.message}
                        <hr>
                        <p>Please check that the models are properly loaded. You may need to restart the application.</p>
                    </div>
                `;
            } finally {
                // Hide loading
                document.getElementById('loading').style.display = 'none';
                document.getElementById('analyzeBtn').disabled = false;
            }
        }

        function displayResults(data) {
            let resultsHtml = '<div class="result-card">';
            
            // Original text
            resultsHtml += `
                <div class="alert alert-info mb-3">
                    <strong><i class="fas fa-quote-left"></i> Your Review:</strong><br>
                    "${data.text}"
                </div>
            `;

            // Results for each model
            if (data.results.traditional) {
                resultsHtml += createModelResult('Traditional ML (Logistic Regression)', data.results.traditional);
            }

            if (data.results.deep_learning) {
                resultsHtml += createModelResult('Deep Learning (Neural Network)', data.results.deep_learning);
            }

            resultsHtml += '</div>';
            document.getElementById('results').innerHTML = resultsHtml;
        }

        function createModelResult(modelName, result) {
            if (result.error) {
                return `
                    <div class="card mb-3">
                        <div class="card-body">
                            <h6>${modelName}</h6>
                            <div class="alert alert-warning">Model not available: ${result.error}</div>
                        </div>
                    </div>
                `;
            }

            const isPositive = result.prediction === 'Positive';
            const sentimentClass = isPositive ? 'sentiment-positive' : 'sentiment-negative';
            const icon = isPositive ? 'fas fa-smile' : 'fas fa-frown';

            return `
                <div class="card mb-3">
                    <div class="card-body">
                        <h6 class="card-title">
                            <i class="fas fa-robot text-primary"></i>
                            ${modelName}
                        </h6>
                        
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="badge ${sentimentClass} p-3 me-3" style="font-size: 1.1em;">
                                        <i class="${icon}"></i>
                                        ${result.prediction}
                                    </div>
                                    <div>
                                        <div class="fw-bold">Confidence: ${result.confidence.toFixed(1)}%</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <small class="text-muted">Positive: ${result.probabilities.positive.toFixed(1)}%</small>
                                    <div class="progress mb-1">
                                        <div class="progress-bar bg-success" style="width: ${result.probabilities.positive}%"></div>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <small class="text-muted">Negative: ${result.probabilities.negative.toFixed(1)}%</small>
                                    <div class="progress">
                                        <div class="progress-bar bg-danger" style="width: ${result.probabilities.negative}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Allow Enter key to submit
        document.getElementById('reviewText').addEventListener('keydown', function(event) {
            if (event.ctrlKey && event.key === 'Enter') {
                analyzeSentiment();
            }
        });
    </script>
</body>
</html>
